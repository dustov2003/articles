---
layout: article.njk
title: video transcoding in web
shortDescription: This article considers challenges of video transcoding in web
creationDate: 2025-02-11
---

# Video transcoding in web

We are going to find best solution for video transcoding


[//]: # (## Тренировка на mp4box.js)

[//]: # ()

[//]: # (Ранее проводились)

<!---

```
┌──────────┬───────────────────────┐
│ demuxer  │                       │ packets for stream 0
╞══════════╡ elementary stream 0   ├──────────────────────►
│          │                       │
│  global  ├───────────────────────┤
│properties│                       │ packets for stream 1
│   and    │ elementary stream 1   ├──────────────────────►
│ metadata │                       │
│          ├───────────────────────┤
│          │                       │
│          │     ...........       │
│          │                       │
│          ├───────────────────────┤
│          │                       │ packets for stream N
│          │ elementary stream N   ├──────────────────────►
│          │                       │
└──────────┴───────────────────────┘
     ▲
     │
     │ read from file, network stream,
     │     grabbing device, etc.
     │
```
-->
## Что такое транскодинг
Транскодинг - 


## Что такое видео

Видео это фактически множество изображений которые быстро быстро меняются. Конечно это определение сильно упрощено,
допустим если мы будем хаотически менять картинки или с недостаточной скоростью, то никакой нормальной внятной картинки,
содержащей что-то осознанное мы не увидим или же наше "видео" будет больше похоже либо на презентацию либо на куча
вспышек.

Для достижений какой-либо анимации важен порядок и быстрота с которой меняются картинки.
![img.png](illustration.png)
Zeitgenössische Illustration (1886)

Картинки сменяющие друг друга это кадры.

А скорость с которой меняются эти кадры называется частотой и измеряется в кадрах в секунду (кадр/с, по англ fps - frame
per second)

## Что такое аудио

Аудио - это звук, тут уже попроще, если не углубляться в физику волн, так как звук это в свою очередь распространение
волн в какой-либо среде (в нашем случае эта среда - воздух). Углубляться в физику данного являния нам не нужно, но можно
почитать об этом [здесь](https://ru.wikipedia.org/wiki/%D0%97%D0%B2%D1%83%D0%BA).

Конечно смотреть видео без звука возможно, как и делалось до 1940-ого года, но в настоящее время технологии
прогрессировали и можно наслаждаться просмотром фильма, а не читать надписи с экрана.

Как машины передают звук?

Простыми словами, звук который передается по воздуху как волна просто колеблет специальное, чувствительное к колебаниям
устройство, например, такое устройство есть в микрофоне. Эти колебания пораждают ток или напряжение определенной формы
(а их мы можем записать в нули и единицы, если нужно сохранить звук),позже на другом девайсе, где нужно проиграть это
напряжение есть тоже специальное устройство которое работает наоборот, напряжение или ток преобразуют в колебания,
которые опять же передаются по воздуху.

## Что такое кодек (codec)

Кодек – программный инструмент для кодирования и декодирования мультимедийной информации. И скорее всего большинство
читателей не поймут что же такое кодек.  
Для этого приведу пару примеров.

## Что такое [FFmpeg](https://www.ffmpeg.org/)

Комплексное кроссплатформенное опенсорс решение для записи, преобразования и потоковой передачи аудио и видео.

Пример с оф. сайта

```shell
ffmpeg -i input.mp4 output.avi
```

Можно использовать как и утилиту командной строки, так и использовать скомпилированные библиотеки

## Установка ffmpeg

FFmpeg предоставляет только исходный код. Его можно скачать с официального [сайта](https://www.ffmpeg.org/)

На случай если нужны скомпилированные библиотеки, то на этот случай есть энтузиасты (ссылки на них тоже есть на
официальном сайте на странице dowload).
Ссылка с архивами релизов (скомпилированные библиотеки имеют пометку "-shared" в названии) ffmpeg
для [Linux/Windows](https://github.com/BtbN/FFmpeg-Builds/releases), для [MacOS](https://evermeet.cx/ffmpeg/)

На случай если нужны бинарники, то благо тоже есть энтузиасты.

* Для Ubuntu

```shell
sudo apt update
sudo apt install ffmpeg
```

* Для Windows

```shell
winget install ffmpeg
```

Возможно будут проблемы, потому что я запускал эту команду раза 3-4 и каждый раз установка не доходила до конца и
зависала где-то на трети.
Можете воспользоваться [ссылкой](https://github.com/GyanD/codexffmpeg/releases/download/7.1/ffmpeg-7.1-full_build.zip) с
которой команда и скачивает ffmpeg  
**!Важно!**  
Нужно будет добавить путь к бинарникам в переменную **Path**

* Для мака [тут](https://evermeet.cx/ffmpeg/)

## Примеры использования FFmpeg

При установке FFmpeg в папке doc или на [сайте](https://www.ffmpeg.org/ffmpeg.html) вы можете найти очень хорошую и
полезную документацию.

Конвертация медиа файла в разные форматы

```shell
ffmpeg -i input.avi output.mp4
```  

Задать новый битрейт

```shell
ffmpeg -i input.avi output.mp4
```

Задать битрейт видео выходного файла на 64 кбит/с:

```shell
ffmpeg -i input.avi -b:v 64k -bufsize 64k output.mp4
```  

Задать частоту кадров в 24 кадр/с для выходного файла

```shell
ffmpeg -i input.avi -r 24 output.mp4
```

Установить частоту кадров входного файла (действительно только для форматов RAW) на 1 кадр/с, а частоту кадров выходного
файла на 24 кадр/с:

```shell
ffmpeg -r 1 -i input.m2v -r 24 output.mp4
```

## Несколько источников откуда можно взять видеофайлы для расчёта метрик

- https://www.sample-videos.com/
- https://file-examples.com/index.php/sample-video-files/sample-mp4-files/

## Полезные источники

- https://www.w3.org/2021/03/media-production-workshop/talks/qiang-fu-video-transcoding.html#intro
- https://github.com/leandromoreira/ffmpeg-libav-tutorial?tab=readme-ov-file#video---what-you-see
- https://habr.com/ru/companies/edison/articles/495614/
- https://github.com/FFmpeg/web
- https://developer.mozilla.org/en-US/docs/Web/API/WebCodecs_API
